
import { BankStatementImportService } from '../bank-statement-import.service';
import * as fs from 'fs/promises';

const mockRepository = {} as any;

async function runTest() {
  const service = new BankStatementImportService(mockRepository);

  const userContent = `Pratinjau Data
Menampilkan semua 818 data

No	Tanggal	Keterangan	Debit	Kredit	Saldo
802	28/01/2026	TRSF E-BANKING CR 2801/FTSCY/WS95051 30800.00 4980365901 261S06Z102687220 VISIONET INTERNASI	-	Rp 30.800	Rp 222.092.210
803	28/01/2026	TRSF E-BANKING CR 2801/FTSCY/WS95051 146300.00 4980365901 261S07ID02690401 VISIONET INTERNASI	-	Rp 146.300	Rp 222.238.510
804	28/01/2026	TRSF E-BANKING CR 2801/FTSCY/WS95051 654842.00 SF 6291 90023 28_9 691039101691269534 AIRPAY INTERNATION	-	Rp 654.842	Rp 222.893.352
805	28/01/2026	TRSF E-BANKING CR 2801/FTSCY/WS95051 475404.00 SF 6293 90025 28_7 748235638417752655 AIRPAY INTERNATION	-	Rp 475.404	Rp 223.368.756
806	28/01/2026	TRSF E-BANKING CR 2801/FTSCY/WS95051 314530.00 SF 2292 90024 28_1 236606962386974546 AIRPAY INTERNATION	-	Rp 314.530	Rp 223.683.286
807	28/01/2026	TRSF E-BANKING CR 2801/FTSCY/WS95051 34031.00 SF 4294 90026 28_2 034259520088541846 AIRPAY INTERNATION	-	Rp 34.031	Rp 223.717.317
808	28/01/2026	TRSF E-BANKING CR 2801/FTSCY/WS95051 284623.00 SF 6296 90028 28_1 838227515425202048 AIRPAY INTERNATION	-	Rp 284.623	Rp 224.001.940
809	28/01/2026	TRSF E-BANKING CR 2801/FTSCY/WS95051 58781.00 SF 8295 90027 28_1 627564871179666492 AIRPAY INTERNATION	-	Rp 58.781	Rp 224.060.721
810	28/01/2026	TRSF E-BANKING CR 2801/FTSCY/WS95051 1359500.00 G174203434 2801 WLSTa215fa7d4beda1 DOMPET ANAK BANGSA	-	Rp 1.359.500	Rp 225.420.221
811	28/01/2026	TRSF E-BANKING CR 2801/FTSCY/WS95051 273500.00 G777216777 2801 WLST4828b2654fd6cf DOMPET ANAK BANGSA	-	Rp 273.500	Rp 225.693.721
812	28/01/2026	TRSF E-BANKING CR 2801/FTSCY/WS95051 1340900.00 G966288751 2801 WLSTb4602af94c0744 DOMPET ANAK BANGSA	-	Rp 1.340.900	Rp 227.034.621
813	28/01/2026	KR OTOMATIS MID : 885002125800 SUSHI MAS TGH: 379500.00 DDR: 2299.00	-	Rp 377.201	Rp 227.411.822
814	28/01/2026	KR OTOMATIS MID : 885002200707 SUSHIMAS CIBINONG TGH: 613800.00 DDR: 920.70	-	Rp 612.879	Rp 228.024.702
815	28/01/2026	KR OTOMATIS MID : 885002200708 SUSHIMAS DEPOK TGH: 324500.00 DDR: 486.75	-	Rp 324.013	Rp 228.348.715
816	28/01/2026	KR OTOMATIS MID : 885002200709 SUSHIMAS GRAND WIS TGH: 909700.00 DDR: 6273.30	-	Rp 903.427	Rp 229.252.142
817	28/01/2026	KR OTOMATIS TANGGAL :27/01 MID : 885001834534 SUSHI MAS-HO QR : 2224200.00 DDR: 15569.40	-	Rp 2.208.631	Rp 231.460.772
818	28/01/2026	TRSF E-BANKING CR 2801/FTSCY/WS95051 55600.00 G457783162 2801 WLST175f9f00c320ce DOMPET ANAK BANGSA	-	Rp 55.600	Rp 231.516.372
819	28/01/2026	TRSF E-BANKING CR 2801/FTSCY/WS95051 772500.00 G912962339 2801 WLST01a9deb5e5d963 DOMPET ANAK BANGSA	-	Rp 772.500	Rp 232.288.872
820	28/01/2026	KR OTOMATIS MID : 885004318544 SUSHIMAS KRAMAT JA TGH: 1012000.00 DDR: 9091.50	-	Rp 1.002.909	Rp 233.291.781
821	28/01/2026	TRSF E-BANKING CR 2801/FTSCY/WS95051 325600.00 4980365901 261S0KDG02773983 VISIONET INTERNASI	-	Rp 325.600	Rp 233.617.381
822	28/01/2026	TRSF E-BANKING CR 2801/FTSCY/WS95051 437800.00 4980365901 261S0MZL02793398 VISIONET INTERNASI	-	Rp 437.800	Rp 234.055.181
823	28/01/2026	SETORAN TUNAI SETORAN TUNAI	-	Rp 38.191.000	Rp 272.246.181
824	28/01/2026	TRSF E-BANKING DB 2801/FTSCY/WS95051 500000.00 MODAL DEPOK TGL 28 JAN KURNIASIH	Rp 500.000	-	Rp 271.746.181`;

  try {
    console.log('--- Testing BCA Business V2 (User Data) ---');
    await fs.writeFile('/tmp/bca_v2_user.csv', userContent);
    const result = await (service as any).parseCSVFile('/tmp/bca_v2_user.csv');
    console.log('Format Detected:', result.formatDetection.format);
    console.log('Delimiter:', result.formatDetection.parsingConfig?.delimiter || 'Auto');
    console.log('Rows Parsed:', result.rows.length);
    if (result.rows.length > 0) {
      console.log('Sample Row 1:', JSON.stringify(result.rows[0], null, 2));
      console.log('Sample Last Row:', JSON.stringify(result.rows[result.rows.length - 1], null, 2));
    }
  } catch (error: any) {
    console.error('Error:', error.message);
    if (error.stack) console.error(error.stack);
  }
}

runTest();
