{
  "info": {
    "name": "Aggregated Transactions API",
    "description": "Complete API collection for testing aggregated transactions endpoints",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "eyJhbGciOiJIUzI1NiIsImtpZCI6InNQSTRVeXBhRnVaZnNBUWsiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2t4eW16dmVpdGxyc3l6amFrempsLnN1cGFiYXNlLmNvL2F1dGgvdjEiLCJzdWIiOiI4YTEzMGEzZS0wNDkwLTQ4YjktYWJlNS03NjlhZjBkZWUzNDUiLCJhdWQiOiJhdXRoZW50aWNhdGVkIiwiZXhwIjoxNzY5MTE2NzU3LCJpYXQiOjE3NjkwODA3NTcsImVtYWlsIjoicGF1bHVzc3VyeWF3YW5AZ21haWwuY29tIiwicGhvbmUiOiIiLCJhcHBfbWV0YWRhdGEiOnsicHJvdmlkZXIiOiJlbWFpbCIsInByb3ZpZGVycyI6WyJlbWFpbCJdfSwidXNlcl9tZXRhZGF0YSI6eyJlbWFpbCI6InBhdWx1c3N1cnlhd2FuQGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJwaG9uZV92ZXJpZmllZCI6ZmFsc2UsInN1YiI6IjhhMTMwYTNlLTA0OTAtNDhiOS1hYmU1LTc2OWFmMGRlZTM0NSJ9LCJyb2xlIjoiYXV0aGVudGljYXRlZCIsImFhbCI6ImFhbDEiLCJhbXIiOlt7Im1ldGhvZCI6InBhc3N3b3JkIiwidGltZXN0YW1wIjoxNzY5MDgwNzU3fV0sInNlc3Npb25faWQiOiJjMDk2YWU5Yy1mOGMxLTQyNmMtODlmMC05ZDY0ODE3NzgzMWMiLCJpc19hbm9ueW1vdXMiOmZhbHNlfQ.QwqV6hQsyRBwB57Gg7mJLHnkkTcUaeGm16HvD9LXodk",
        "type": "string"
      }
    ]
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000/api/v1/pos-imports",
      "type": "string"
    },
    {
      "key": "company_id",
      "value": "{{$guid}}",
      "type": "string"
    },
    {
      "key": "branch_id",
      "value": "{{$guid}}",
      "type": "string"
    },
    {
      "key": "transaction_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "import_id",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "1. List Aggregated Transactions",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "x-branch-id",
            "value": "{{branch_id}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/aggregated-transactions?page=1&limit=10&company_id={{company_id}}",
          "host": ["{{baseUrl}}"],
          "path": ["aggregated-transactions"],
          "query": [
            {
              "key": "page",
              "value": "1"
            },
            {
              "key": "limit",
              "value": "10"
            },
            {
              "key": "company_id",
              "value": "{{company_id}}"
            },
            {
              "key": "transaction_date_from",
              "value": "2024-01-01",
              "disabled": true
            },
            {
              "key": "transaction_date_to",
              "value": "2024-12-31",
              "disabled": true
            },
            {
              "key": "status",
              "value": "READY",
              "disabled": true
            },
            {
              "key": "is_reconciled",
              "value": "false",
              "disabled": true
            }
          ]
        }
      }
    },
    {
      "name": "2. Create Aggregated Transaction",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-branch-id",
            "value": "{{branch_id}}",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"company_id\": \"{{company_id}}\",\n  \"branch_id\": \"{{branch_id}}\",\n  \"source_type\": \"POS\",\n  \"source_id\": \"{{$guid}}\",\n  \"source_ref\": \"BILL{{$randomInt}}-SALES{{$randomInt}}\",\n  \"transaction_date\": \"{{$isoTimestamp}}\",\n  \"payment_method_id\": 1,\n  \"gross_amount\": {{$randomInt}},\n  \"discount_amount\": {{$randomInt}},\n  \"tax_amount\": {{$randomInt}},\n  \"service_charge_amount\": 0,\n  \"net_amount\": {{$randomInt}},\n  \"currency\": \"IDR\",\n  \"status\": \"READY\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/aggregated-transactions",
          "host": ["{{baseUrl}}"],
          "path": ["aggregated-transactions"]
        }
      }
    },
    {
      "name": "3. Get Aggregated Transaction by ID",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "x-branch-id",
            "value": "{{branch_id}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/aggregated-transactions/{{transaction_id}}",
          "host": ["{{baseUrl}}"],
          "path": ["aggregated-transactions", "{{transaction_id}}"]
        }
      }
    },
    {
      "name": "4. Update Aggregated Transaction",
      "request": {
        "method": "PUT",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-branch-id",
            "value": "{{branch_id}}",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"gross_amount\": 150000,\n  \"discount_amount\": 7500,\n  \"tax_amount\": 15000,\n  \"net_amount\": 157500,\n  \"status\": \"PENDING\",\n  \"version\": 1\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/aggregated-transactions/{{transaction_id}}",
          "host": ["{{baseUrl}}"],
          "path": ["aggregated-transactions", "{{transaction_id}}"]
        }
      }
    },
    {
      "name": "5. Delete Aggregated Transaction",
      "request": {
        "method": "DELETE",
        "header": [
          {
            "key": "x-branch-id",
            "value": "{{branch_id}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/aggregated-transactions/{{transaction_id}}",
          "host": ["{{baseUrl}}"],
          "path": ["aggregated-transactions", "{{transaction_id}}"]
        }
      }
    },
    {
      "name": "6. Restore Aggregated Transaction",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "x-branch-id",
            "value": "{{branch_id}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/aggregated-transactions/{{transaction_id}}/restore",
          "host": ["{{baseUrl}}"],
          "path": ["aggregated-transactions", "{{transaction_id}}", "restore"]
        }
      }
    },
    {
      "name": "7. Reconcile Transaction",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-branch-id",
            "value": "{{branch_id}}",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"reconciled_by\": \"{{$guid}}\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/aggregated-transactions/{{transaction_id}}/reconcile",
          "host": ["{{baseUrl}}"],
          "path": ["aggregated-transactions", "{{transaction_id}}", "reconcile"]
        }
      }
    },
    {
      "name": "8. Batch Reconcile Transactions",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-branch-id",
            "value": "{{branch_id}}",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"transaction_ids\": [\n    \"{{$guid}}\",\n    \"{{$guid}}\",\n    \"{{$guid}}\"\n  ],\n  \"reconciled_by\": \"{{$guid}}\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/aggregated-transactions/batch/reconcile",
          "host": ["{{baseUrl}}"],
          "path": ["aggregated-transactions", "batch", "reconcile"]
        }
      }
    },
    {
      "name": "9. Get Summary Statistics",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "x-branch-id",
            "value": "{{branch_id}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/aggregated-transactions/summary?company_id={{company_id}}&transaction_date_from=2024-01-01&transaction_date_to=2024-12-31",
          "host": ["{{baseUrl}}"],
          "path": ["aggregated-transactions", "summary"],
          "query": [
            {
              "key": "company_id",
              "value": "{{company_id}}"
            },
            {
              "key": "transaction_date_from",
              "value": "2024-01-01"
            },
            {
              "key": "transaction_date_to",
              "value": "2024-12-31"
            },
            {
              "key": "branch_id",
              "value": "{{branch_id}}",
              "disabled": true
            }
          ]
        }
      }
    },
    {
      "name": "10. Generate Journal Entries",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-branch-id",
            "value": "{{branch_id}}",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"company_id\": \"{{company_id}}\",\n  \"branch_id\": \"{{branch_id}}\",\n  \"transaction_date_from\": \"2024-01-01\",\n  \"transaction_date_to\": \"2024-12-31\",\n  \"payment_method_id\": 1,\n  \"include_unreconciled_only\": true,\n  \"transaction_ids\": [\n    \"{{$guid}}\",\n    \"{{$guid}}\"\n  ]\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/aggregated-transactions/generate-journal",
          "host": ["{{baseUrl}}"],
          "path": ["aggregated-transactions", "generate-journal"]
        }
      }
    },
    {
      "name": "11. Assign Journal to Transaction",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-branch-id",
            "value": "{{branch_id}}",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"journal_id\": \"{{$guid}}\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/aggregated-transactions/{{transaction_id}}/assign-journal",
          "host": ["{{baseUrl}}"],
          "path": ["aggregated-transactions", "{{transaction_id}}", "assign-journal"]
        }
      }
    },
    {
      "name": "12. Check Source Exists",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "x-branch-id",
            "value": "{{branch_id}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/aggregated-transactions/check-source?source_type=POS&source_id={{$guid}}&source_ref=BILL001-SALES001",
          "host": ["{{baseUrl}}"],
          "path": ["aggregated-transactions", "check-source"],
          "query": [
            {
              "key": "source_type",
              "value": "POS"
            },
            {
              "key": "source_id",
              "value": "{{$guid}}"
            },
            {
              "key": "source_ref",
              "value": "BILL001-SALES001"
            }
          ]
        }
      }
    },
    {
      "name": "13. Get Unreconciled Transactions",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "x-branch-id",
            "value": "{{branch_id}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/aggregated-transactions/unreconciled?company_id={{company_id}}&transaction_date_from=2024-01-01&transaction_date_to=2024-12-31",
          "host": ["{{baseUrl}}"],
          "path": ["aggregated-transactions", "unreconciled"],
          "query": [
            {
              "key": "company_id",
              "value": "{{company_id}}"
            },
            {
              "key": "transaction_date_from",
              "value": "2024-01-01"
            },
            {
              "key": "transaction_date_to",
              "value": "2024-12-31"
            },
            {
              "key": "branch_id",
              "value": "{{branch_id}}",
              "disabled": true
            }
          ]
        }
      }
    },
    {
      "name": "ðŸ†• 14. Generate from POS Import Lines",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-branch-id",
            "value": "{{branch_id}}",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"branch_id\": \"{{branch_id}}\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/aggregated-transactions/generate-from-import/{{import_id}}",
          "host": ["{{baseUrl}}"],
          "path": ["aggregated-transactions", "generate-from-import", "{{import_id}}"]
        }
      }
    }
  ]
}